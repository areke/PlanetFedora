<!DOCTYPE html> 
<html> 
<head> 
    <title>Planet Fedora</title> 
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <link rel="stylesheet" href="css/jquery.mobile-1.2.0.min.css" />
    <link rel="stylesheet" href="css/index.css" />
    <script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
    <script type="text/javascript">$(document).bind("mobileinit", function () {  $.mobile.defaultPageTransition = "none"; });</script>
    <script type="text/javascript" src="js/jquery.mobile-1.2.0.min.js"></script>
    <script src="cordova-2.2.0.js"></script>
    <script src ="childbrowser.js"></script>
    <script src ="share.js"></script>
</head> 
<body> 

<div data-role="page" id = "mainPage">

    <div data-role="header" data-theme="b" data-tap-toggle="false" height:"50px;">
        <h1 style = "font-size: 23px; white-space: normal;">Planet Fedora</h1>
        <div data-role="navbar">
            <ul>
                <li><a href="#mainPage" id="#nav1" class="ui-btn-active ui-state-persist">Home</a></li>
                <li><a href="#Favorites" id="#nav2">Favorites</a></li>
                <li><a href="#About" id="#nav3">About</a></li>
            </ul>
        </div>
    </div>

    <div data-role="content">   
        <ul id = "list" data-role="listview" data-icon="arrow-r" data-inset="true" data-filter="false" data-theme="d" style="white-space: normal">

        </ul> 
    </div>

    <div data-role="footer" data-theme="b" data-position="fixed" style = "text-align:center; height: 50px;">
        <div data-role="navbar">
            <ul id = "navigation1">
                <li><a href="#refresh" id = "refresh">Check For Updates</a></li>
            </ul>
        </div>
    </div>

</div>

<div data-role="page" id="DisplayPage">
    <div data-role="header" data-theme="b" style = "white-space: normal;">
        <h1 style = "font-size: 23px; white-space: normal; margin-left: auto; margin-right: auto; width: 300px;" id = "titleText"></h1>
    </div>

    <div data-role="content" id = "article" style = "overflow: auto;">
    </div>

    <div data-role="popup" id="addFavorite" data-overlay-theme="b" style = "text-align:center;">
        <p id = "disMes" style = "font-size: 24px;"><br><strong></strong><br><br></p>
    </div>

    <div data-role="footer" data-theme="b" data-position="fixed" style = "text-align:center; height: 50px;">
        <div data-role="navbar">
            <ul id = "navigation">
                <li><a href="#mainPage" data-rel="back" id = "back" data-transition="slide">Back</a></li>
                <li><a href="#addFavorite" id = "add" data-transition="pop" data-rel = "popup" data-position-to="window"></a></li>
                <li><a href="#share" id = "share" data-transition="slide">Share</a></li>
            </ul>
        </div>
    </div>
</div>

<div data-role="page" id="DisplayPage2">
    <div data-role="header" data-theme="b" style = "white-space: normal;">
        <h1 style = "font-size: 23px; white-space: normal; margin-left: auto; margin-right: auto; width: 300px;" id = "titleText2"></h1>
    </div>

    <div data-role="content" id = "article2" style = "overflow: auto;">
    </div>

    <div data-role="popup" id="addFavorite2" data-overlay-theme="b" style = "text-align:center;">
        <p id = "disMes2" style = "font-size: 24px;"><br><strong></strong><br><br></p>
    </div>

    <div data-role="footer" data-theme="b" data-position="fixed" style = "text-align:center; height: 50px;">
        <div data-role="navbar">
            <ul id = "navigation2">
                <li><a href="#mainPage" data-rel="back" id = "back2" data-transition="slide">Back</a></li>
                <li><a href="#addFavorite2" id = "add2" data-transition="pop" data-rel = "popup" data-position-to="window"></a></li>
                <li><a href="#share" id = "share2" data-transition="slide">Share</a></li>
            </ul>
        </div>
    </div>
</div>

<div data-role="page" id="About">
    <div data-role="header" data-theme="b" data-tap-toggle="false" height:"50px;">
        <h1 style = "font-size: 23px; white-space: normal;">Planet Fedora</h1>
        <div data-role="navbar">
            <ul id = "navigation">
                <li><a href="#mainPage" id="#nav1">Home</a></li>
                <li><a href="#Favorites" id="#nav2">Favorites</a></li>
                <li><a href="#About" id="#nav3" class="ui-btn-active ui-state-persist">About</a></li>
            </ul>
        </div>
    </div>
    <div data-role="content" data-theme="b">
        <h1>About</h1>
        <p><a href = "http://planet.fedoraproject.org">Fedora Planet</a> is a website that displays blog posts from various Fedora contributors. While these blog posts don't necessarily reflect the opinions of the <a href = "http://fedoraproject.org">Fedora Project</a>, they do express the viewpoints of the individuals contributing to Fedora Planet. This application for Android devices was written to make it faster and easier to view the contents of Fedora Planet. In order to do this, it uses the project's <a href = "http://planet.fedoraproject.org/rss20.xml">RSS feed</a>.<br><br>If you would like to read more about how to use this application, visit our <a href = "https://github.com/areke/PlanetFedora/wiki">wiki page</a>.</p>
        <h1>Contribute</h1>
        <p>Please contribute if you know a way to make this better. File an <a href = "https://github.com/areke/PlanetFedora/issues">issue</a> if you have any problems or suggestions. You can also fork this repository and open a pull request with your changes.</p>
	    <h1>Credits</h1>
        <p>This Application has developed by. Mark Klein (areke) for Google-Code-In 2012 as a fulfillment of <a href = "http://www.google-melange.com/gci/task/view/google/gci2012/8123205">this Task</a> under the mentorship of Fedora Project.</p>
 		<p>[Last Release: 27 Dec. 2012]</p>
 
    </div>
</div>

<div data-role="page" id="Favorites">
    <div data-role="header" data-theme="b" data-tap-toggle="false" height:"50px;">
        <h1 style = "font-size: 23px; white-space: normal;">Planet Fedora</h1>
        <div data-role="navbar">
            <ul id = "navigation">
                <li><a href="#mainPage" id="#nav1">Home</a></li>
                <li><a href="#Favorites" id="#nav2" class="ui-btn-active ui-state-persist">Favorites</a></li>
                <li><a href="#About" id="#nav3">About</a></li>
            </ul>
        </div>
    </div>
    <div data-role="content" id="favoriteContent"  style = "overflow: auto;">
        <ul id = "list2" data-role="listview" data-icon="arrow-r" data-inset="true" data-filter="false" data-theme="d" style="white-space: normal">

        </ul> 
        <h1 id = "yourFavorites" style = "margin-left:auto; margin-right:auto; text-align:center;"></h1>
    </div>
</div>

<script type = "text/javascript">
    $(document).ready(function() {
        var selectedEntry = "";
        function refresh() {
            document.addEventListener("deviceready", onDeviceReady, false);
            var feed = "http://planet.fedoraproject.org/rss20.xml";
            xmlhttp = new XMLHttpRequest();
            xmlhttp.open("GET",feed,false); 
            xmlhttp.send();
            xmlDoc = xmlhttp.responseXML; //Get the xml
            items = xmlDoc.getElementsByTagName("item"); //Get each item individually
            var list = "";
            for (i = 0; i < items.length; i++) { 
                    var des = (items[i].getElementsByTagName("title")[0]);
                        if ((typeof des === "undefined")) {
                            des = "No Title"
                        }
                        else
                        {
                            des = des.childNodes[0];
                            if ((typeof des === "undefined")) {
                                alert(des);
                                des = "No Author: No Title";
                            }
                            else {
                                des = des.nodeValue;
                            }

                        }
                    var index = des.indexOf(": ");
                    var splits = [des.slice(0,index), des.slice(index+2)]; //Seperate the author from the title
                    var author = splits[0];
                    var title = splits[1];
                    var date = (items[i].getElementsByTagName("pubDate")[0]);
                    if ((typeof date === "undefined")) {
                        date = "No Date"
                    }
                    else
                    {
                        date = date.childNodes[0];
                        if ((typeof date === "undefined")) {
                            date = "No Date";
                        }
                        else {
                            date = date.nodeValue;
                        }

                    }
                    var description = items[i].getElementsByTagName("description")[0];
                    if ((typeof description === "undefined")) {
                        description = "No Description"
                    }
                    else
                    {
                        description = description.childNodes[0];
                        if ((typeof description === "undefined")) {
                            description = "No Description";
                        }
                        else {
                            description = description.nodeValue;
                        }

                    }
                    var i1 = (items[i].getElementsByTagName("description")[0].childNodes[0].nodeValue).indexOf("<img");
                    var i2 = (items[i].getElementsByTagName("description")[0].childNodes[0].nodeValue).indexOf(';">');
                    var img = description.slice(i1,i2)+';">';
                    list += '<li class="contentLink" style = "height: 160px"; text-align:center;><a href="#" data-transition="slide" class="contentLink" style = "font-size: 16px; text-decoration: none; color: black; white-space: normal; margin-top: 5px;" data-entryid="'+i+'">' + img + title + '<h3>By: ' + author + '</h3><p>' + date + '</p><br></a></li>'; //Create the list
                }
            $("#list").append(list);
            $("#list").listview("refresh");
            $.mobile.loading('hide');
            $(".contentLink").bind("click", function() { //Capture link click
                $("#article").empty();
                selected = $(this).data("entryid");
                if (typeof selected !== "undefined") { //Check if everything is okay
                    selectedEntry = selected;
                }
                window.location = "#DisplayPage"; //View the content
            });
        }

        refresh();

        $("#refresh").click(function() {
            $.mobile.loading('show', {
                theme: "e",
                text: "\nUpdating...\n",
                textonly: "true",
                textVisible: true
            });
            setTimeout(function(){refresh()}, 50);
        });

        $("#DisplayPage").bind("pagebeforeshow", function(prepage) {
            var storage = window.localStorage;
            var des = (items[selectedEntry].getElementsByTagName("title")[0].childNodes[0].nodeValue); //get title name
            var index = des.indexOf(": "); //Split 
            var splits = [des.slice(0,index), des.slice(index+2)];
            var title = splits[1];
            var key = "cm4io2318ew0iodsjfa08p1o2j3mrdfsc";
            document.getElementById("titleText").innerHTML = title; //Set title
            content = items[selectedEntry].getElementsByTagName("description")[0].childNodes[0].nodeValue;
            if (storage.getItem(title+key))
            {
                $("#add .ui-btn-text").text("Unfavorite");
            }
            else
            {
                $("#add .ui-btn-text").text("Favorite");
            }

            $("#article").append(content); //Preload content

            $("a").click(function(event) {
                event.preventDefault(); //Stop links from opening
                href = this.href; //Get link from the link that was clicked
                if (href.indexOf("file:///android_asset/www/index.html") == -1) { //Make sure none of these links were clicked
                    window.plugins.childBrowser.showWebPage(href, { showLocationBar: true }); //Open the link in a childbrowser in order to prevent glitches as well as to make it easier to get back to using the app
                }
            });
            $("#share").unbind("click").click(function() {
                window.plugins.share.show({ //Let the user able to share the article easily
                    subject: 'Article on Fedora Planet',
                    text: 'Here is a cool article I found on Fedora Planet:\n'   + items[selectedEntry].getElementsByTagName("link")[0].childNodes[0].nodeValue},
                    function() {}, // Success function
                    function() {alert('Share failed')} // Failure function
                );
            });
            $("#add").unbind("click").click(function() {
                var storage = window.localStorage;
                var localStorage = window.localStorage;
                var key = "cm4io2318ew0iodsjfa08p1o2j3mrdfsc";
                var des = (items[selectedEntry].getElementsByTagName("title")[0].childNodes[0].nodeValue);
                var index = des.indexOf(": ");
                var splits = [des.slice(0,index), des.slice(index+2)]; //Seperate the author from the title
                var author = splits[0];
                var title = splits[1];
                var date = (items[selectedEntry].getElementsByTagName("pubDate")[0].childNodes[0].nodeValue).split(" +0000")[0];
                var description = items[selectedEntry].getElementsByTagName("description")[0].childNodes[0].nodeValue;
                var i1 = (items[selectedEntry].getElementsByTagName("description")[0].childNodes[0].nodeValue).indexOf("<img");
                var i2 = (items[selectedEntry].getElementsByTagName("description")[0].childNodes[0].nodeValue).indexOf(';">');
                var img = description.slice(i1,i2)+';">';
                if (storage.getItem(title+key))
                {
                    storage.removeItem(title+"title");
                    storage.removeItem(title+"author");
                    storage.removeItem(title+"date");
                    storage.removeItem(title+"description");
                    storage.removeItem(title+"image");
                    storage.removeItem(title+key);
                    document.getElementById("disMes").innerHTML = "Successfully removed from favorites.";
                    $("#add .ui-btn-text").text("Favorite");

                }
                else 
                {
                    storage.setItem((title+"title"), title);
                    storage.setItem((title+"author"), author);
                    storage.setItem((title+"date"), date);
                    storage.setItem((title+"description"), description);
                    storage.setItem((title+"image"), img);
                    storage.setItem((title+key), title);
                    document.getElementById("disMes").innerHTML = "Successfully added to favorites.";
                    $("#add .ui-btn-text").text("Unfavorite");
                }

            });
        });
        $("#Favorites").bind("pagebeforeshow", function() {
            $("#list2").empty();
            var storage = window.localStorage;
            var localStorage = window.localStorage;
            var localStorageKeys = Object.keys(localStorage);
            var list2 = "";
            var localStorageValues = [];
            for (var i = 0; i<=localStorageKeys.length-1; i++)
            {
              if (localStorageKeys[i].indexOf("cm4io2318ew0iodsjfa08p1o2j3mrdfsc") != -1)
                {
                localStorageValues[localStorageValues.length] = window.localStorage.getItem(localStorageKeys[i]);
                }
            }
            for (var i = 0; i<=localStorageValues.length-1; i++) {
                var name = localStorageValues[i];
                var title = storage.getItem(name+"title");
                var author = storage.getItem(name+"author");
                var date = storage.getItem(name+"date");
                var description = storage.getItem(name+"description");
                var img = storage.getItem(name+"image");
                list2 += '<li class="contentLink" style = "height: 160px"; text-align:center;><a href="#" data-transition="slide" class="contentLink2" style = "font-size: 16px; text-decoration: none; color: black; white-space: normal; margin-top: 5px;" data-entryid="'+i+'">' + img + title + '<h3>By: ' + author + '</h3><p>' + date + '</p><br></a></li>'; //Create the list
                }
            $("#list2").append(list2);
            $("#list2").listview("refresh");
            if (localStorageValues.length == 0)
            {
                $("#yourFavorites").text("No favorites to show");
            }
            else
            {
                $("#yourFavorites").text("");
            }


            $(".contentLink2").bind("click", function() { //Capture link click
                $("#article").empty();
                selected = $(this).data("entryid");
                if (typeof selected !== "undefined") { //Check if everything is okay
                    selectedEntry = selected;
                }
                window.location = "#DisplayPage2"; //View the content
            });
            $("#About").bind("pagebeforeshow", function(prepage) {
                $("a").click(function(event) {
                    event.preventDefault(); //Stop links from opening
                    href = this.href; //Get link from the link that was clicked
                    if (href.indexOf("file:///android_asset/www/index.html") == -1) { //Make sure none of these links were clicked
                        window.plugins.childBrowser.showWebPage(href, { showLocationBar: true }); //Open the link in a childbrowser in order to prevent glitches as well as to make it easier to get back to using the app
                    }
                });
            });
            $("#DisplayPage2").bind("pagebeforeshow", function(prepage) {
                $("#article2").empty();
                var key = "cm4io2318ew0iodsjfa08p1o2j3mrdfsc";
                var name = localStorageValues[selectedEntry];
                var title = storage.getItem(name+"title");
                var description = storage.getItem(name+"description");
                document.getElementById("titleText2").innerHTML = title; //Set title
                content = description;
                $("#add2 .ui-btn-text").text("Unfavorite");
                $("#article2").append(content); //Preload content

                $("a").click(function(event) {
                    event.preventDefault(); //Stop links from opening
                    href = this.href; //Get link from the link that was clicked
                    if (href.indexOf("file:///android_asset/www/index.html") == -1) { //Make sure none of these links were clicked
                        window.plugins.childBrowser.showWebPage(href, { showLocationBar: true }); //Open the link in a childbrowser in order to prevent glitches as well as to make it easier to get back to using the app
                    }
                });
                $("#share2").unbind("click").click(function() {
                    window.plugins.share.show({ //Let the user able to share the article easily
                        subject: 'Article on Fedora Planet',
                        text: 'Here is a cool article I found on Fedora Planet:\n'   + items[selectedEntry].getElementsByTagName("link")[0].childNodes[0].nodeValue},
                        function() {}, // Success function
                        function() {alert('Share failed')} // Failure function
                    );
                });
                $("#add2").unbind("click").click(function() {
                    var storage = window.localStorage;
                    var localStorage = window.localStorage;
                    var key = "cm4io2318ew0iodsjfa08p1o2j3mrdfsc";
                    if (storage.getItem(title+key))
                    {
                        storage.removeItem(title+"title");
                        storage.removeItem(title+"author");
                        storage.removeItem(title+"date");
                        storage.removeItem(title+"description");
                        storage.removeItem(title+"image");
                        storage.removeItem(title+key);
                        document.getElementById("disMes2").innerHTML = "Successfully removed from favorites.";

                    }

                });
            });
        });
        function onDeviceReady() {
            navigator.splashscreen.hide();
        }
    });

</script>
</body>
</html>